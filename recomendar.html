<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Recomendaciones - Diversencia*</title>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <style>
    :root { --azul: #4db7c3; --naranja: #e37c3a; --gris: #f4f4f4; }
    
    body { background-color: #fff; margin: 0; font-family: 'Fredoka', sans-serif; }

    .filtros-fijos {
      position: sticky; top: 0; background: white; z-index: 100;
      padding: 15px; border-bottom: 1px solid #eee; text-align: center;
    }

    .filter-btn {
      padding: 8px 18px; margin: 5px; border: 2px solid var(--azul);
      background: white; color: var(--azul); border-radius: 25px;
      cursor: pointer; font-weight: 600; transition: 0.3s;
    }

    .filter-btn.active { background: var(--azul); color: white; }

    .seccion-horizontal { padding: 30px 0; }
    .titulo-cat { margin-left: 5%; color: #333; font-size: 1.8rem; }

    .scroll-container {
      display: flex; overflow-x: auto; gap: 20px; padding: 10px 5%;
      scroll-behavior: smooth; scrollbar-width: none;
    }
    .scroll-container::-webkit-scrollbar { display: none; }

    .card {
      min-width: 220px; max-width: 220px; background: white;
      border-radius: 18px; overflow: hidden; border: 1px solid #eee;
      cursor: pointer; transition: transform 0.3s ease;
    }
    .card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
    
    .card img { width: 100%; aspect-ratio: 2/3; object-fit: cover; }
    .card-body { padding: 12px; }
    .card-body h3 { margin: 0; font-size: 1rem; color: #222; }
    .card-tag { font-size: 0.75rem; color: var(--azul); font-weight: 600; text-transform: uppercase; }

    /* MODAL (VENTANA EMERGENTE) */
    .modal {
      display: none; position: fixed; z-index: 1000; left: 0; top: 0;
      width: 100%; height: 100%; background: rgba(0,0,0,0.7);
      align-items: center; justify-content: center; backdrop-filter: blur(5px);
    }
    .modal-content {
      background: white; width: 90%; max-width: 600px; border-radius: 30px;
      padding: 30px; position: relative; display: flex; gap: 20px;
    }
    .modal-close { position: absolute; top: 15px; right: 20px; font-size: 2rem; cursor: pointer; color: #999; }
    .modal-img { width: 40%; border-radius: 15px; }
    .modal-info { width: 60%; }
    .btn-plataforma {
      display: inline-block; margin-top: 15px; padding: 10px 20px;
      background: var(--naranja); color: white; text-decoration: none;
      border-radius: 50px; font-weight: 600;
    }

    @media (max-width: 600px) {
      .modal-content { flex-direction: column; align-items: center; text-align: center; }
      .modal-img { width: 60%; }
      .modal-info { width: 100%; }
    }
  </style>
</head>
<body>

<header class="hero1">
  <div class="contenedor-logo">
    <h1><span class="nombre">Recomendar</span><span class="asterisco">*</span></h1>
    <p class="subtitulo">Historias que rompen barreras</p>
  </div>
</header>

<div class="filtros-fijos">
  <button class="filter-btn active" onclick="filtrar('todos')">Todos</button>
  <button class="filter-btn" onclick="filtrar('Neurodiversidad')">Neurodiversidad</button>
  <button class="filter-btn" onclick="filtrar('Física')">Física</button>
  <button class="filter-btn" onclick="filtrar('Sensorial')">Sensorial</button>
  <button class="filter-btn" onclick="filtrar('Intelectual')">Intelectual</button>
</div>

<main id="app">
  <section class="seccion-horizontal" id="sec-pelis">
    <h2 class="titulo-cat">Películas</h2>
    <div class="scroll-container" id="container-Pelicula"></div>
  </section>

  <section class="seccion-horizontal" id="sec-series">
    <h2 class="titulo-cat">Series</h2>
    <div class="scroll-container" id="container-Serie"></div>
  </section>

  <section class="seccion-horizontal" id="sec-libros">
    <h2 class="titulo-cat">Libros</h2>
    <div class="scroll-container" id="container-Libro"></div>
  </section>
</main>

<div id="miModal" class="modal">
  <div class="modal-content">
    <span class="modal-close" onclick="cerrarModal()">&times;</span>
    <img id="m-img" class="modal-img" src="" alt="">
    <div class="modal-info">
      <span id="m-div" class="card-tag"></span>
      <h2 id="m-tit" style="margin: 10px 0;"></h2>
      <p id="m-aut" style="color: #888; font-style: italic;"></p>
      <p id="m-sin"></p>
      <div id="m-plat" class="btn-plataforma"></div>
    </div>
  </div>
</div>

<script>
  const URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRI0jqC8RUmQwifG87iizwfsvq7UMMCw_Qbnv6oNmVuBoVOOxkr1C_S_P2rlPagnS-78ghJc5d-bk-L/pub?output=csv';

  async function cargarCSV() {
    const res = await fetch(URL);
    const csv = await res.text();
    const filas = csv.split('\n').slice(1);
    
    const items = filas.map(f => {
      const c = f.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
      if(c.length < 5) return null;
      return {
        titulo: c[0].replace(/"/g, ''), formato: c[1].trim(), diversidad: c[2].trim(),
        edad: c[3].trim(), autor: c[4].trim(), sinopsis: c[5].replace(/"/g, ''),
        imagen: c[6].trim(), plataforma: c[7].trim()
      };
    }).filter(i => i);

    render(items);
  }

  function render(data) {
    const containers = {
      'Pelicula': document.getElementById('container-Pelicula'),
      'Serie': document.getElementById('container-Serie'),
      'Libro': document.getElementById('container-Libro')
    };

    data.forEach(item => {
      const div = document.createElement('div');
      div.className = 'card';
      div.setAttribute('data-div', item.diversidad);
      div.onclick = () => abrirModal(item);
      div.innerHTML = `
        <img src="${item.imagen}">
        <div class="card-body">
          <span class="card-tag">${item.diversidad}</span>
          <h3>${item.titulo}</h3>
        </div>
      `;
      if(containers[item.formato]) containers[item.formato].appendChild(div);
    });
  }

  function abrirModal(i) {
    document.getElementById('m-img').src = i.imagen;
    document.getElementById('m-tit').innerText = i.titulo;
    document.getElementById('m-div').innerText = i.diversidad;
    document.getElementById('m-aut').innerText = i.autor;
    document.getElementById('m-sin').innerText = i.sinopsis;
    document.getElementById('m-plat').innerText = "Disponible en: " + i.plataforma;
    document.getElementById('miModal').style.display = 'flex';
  }

  function cerrarModal() { document.getElementById('miModal').style.display = 'none'; }

  function filtrar(tipo) {
    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
    event.target.classList.add('active');
    
    document.querySelectorAll('.card').forEach(card => {
      card.style.display = (tipo === 'todos' || card.dataset.div === tipo) ? 'block' : 'none';
    });
  }

  window.onclick = (e) => { if(e.target == document.getElementById('miModal')) cerrarModal(); }
  
  cargarCSV();
</script>
</body>
</html>
